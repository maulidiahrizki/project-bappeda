<%- include('../partials/header__') %>
<%- include('../partials/sidebar__') %>

<style>
#drop-zone {
    width: 200px;
    height: 200px;
    border: 2px dashed #ccc;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden; /* Supaya gambar tidak keluar kotak */
    position: relative;
    background-color: #f9f9f9;
    cursor: pointer; /* Menambah cursor pointer saat area drop zone diklik */
}

#drop-zone i {
    font-size: 30px;
    color: #ccc;
    position: absolute; /* Agar ikon tetap di atas gambar */
}

#preview-image {
    width: 100%;
    height: 100%;
    object-fit: cover; /* Memastikan gambar memenuhi area kotak tanpa distorsi */
    display: block;
}


/* Styling untuk select input */
.form-select {
    width: 100%;
    padding: 10px;
    border-radius: 8px; /* Menambahkan radius untuk sudut yang lebih halus */
    border: 1px solid #ddd; /* Batas abu-abu yang halus */
    background-color: #f9f9f9; /* Latar belakang yang lebih lembut */
    font-size: 16px;
    transition: all 0.3s ease; /* Efek transisi saat interaksi */
}

/* Efek focus pada input select */
.form-select:focus {
    border-color: #66afe9; /* Warna biru saat focus */
    outline: none; /* Menghilangkan outline default */
    background-color: #fff; /* Mengubah background jadi putih saat focus */
}

/* Menambahkan efek ketika hovering */
.form-select:hover {
    border-color: #ccc; /* Ganti warna border saat hover */
    background-color: #f1f1f1; /* Ganti background saat hover */
}

/* Styling untuk label */
.col-form-label {
    font-weight: 500; /* Menebalkan label agar lebih terlihat */
}

/* Menambahkan margin untuk jarak antar input */
.form-group {
    margin-bottom: 1.5rem; /* Memberikan jarak antar elemen form */
}

/* Styling untuk kotak dua kolom */
.form-group.double-column {
    display: flex;
    justify-content: space-between;
    gap: 20px;
}

.form-group.double-column .col-md-6 {
    width: 48%;
}

.data-box {
    border: 2px solid #ccc;
    border-radius: 10px;
    padding: 20px;
    background-color: #f9f9f9;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    margin-top: 20px;
}

/* Layout untuk data dalam dua kolom */
.form-wrapper {
    display: grid;
    grid-template-columns: 1fr 1fr; /* Membagi menjadi dua kolom */
    gap: 20px; /* Jarak antar elemen */
}

/* Styling untuk setiap input */
.form-control {
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ddd;
    font-size: 16px;
    transition: all 0.3s ease;
}

/* Efek focus */
.form-control:focus {
    border-color: #66afe9;
    outline: none;
    background-color: #fff;
}

/* Styling label */
.col-form-label {
    font-weight: 500;
}

/* Tombol Minimalis */
.btn-minimal {
    padding: 8px 16px; /* Ukuran kecil tapi tetap nyaman */
    font-size: 14px;   /* Font yang proporsional */
    font-weight: 500;  /* Sedikit bold */
    border: none;      /* Tanpa border untuk kesan modern */
    border-radius: 5px; /* Sudut tumpul ringan */
    cursor: pointer;
    transition: all 0.3s ease; /* Animasi halus */
}

/* Warna Dasar Tombol */
.btn-danger {
    background-color: #f44336; /* Merah elegan */
    color: white;
}

.btn-success {
    background-color: #4caf50; /* Hijau elegan */
    color: white;
}

/* Hover Efek */
.btn-danger:hover {
    background-color: #d32f2f; /* Merah lebih gelap */
    box-shadow: 0 4px 8px rgba(244, 67, 54, 0.2); /* Bayangan lembut */
}

.btn-success:hover {
    background-color: #388e3c; /* Hijau lebih gelap */
    box-shadow: 0 4px 8px rgba(76, 175, 80, 0.2); /* Bayangan lembut */
}

/* Fokus Efek */
.btn-minimal:focus {
    outline: 2px solid #ddd; /* Fokus minimal */
    outline-offset: 2px;
}

/* Responsif */
@media (max-width: 768px) {
    .btn-wrapper {
        display: flex;
        justify-content: center;
        gap: 10px; /* Jarak antar tombol */
    }
}

/* Styling untuk tombol Lihat Data di sebelah kanan */
.x_title {
    display: flex;
    justify-content: space-between; /* Membuat ruang antara elemen kiri dan kanan */
    align-items: center; /* Vertikal align agar elemen rata tengah */
}

.btn-wrapper {
    margin-left: auto; /* Memastikan tombol berada di sebelah kanan */
}

.btn-wrapper-lihatdata {
    position: absolute;
    right: 30px; /* Tombol akan terletak di ujung kanan */
    top: 16%; /* Menempatkan tombol di tengah vertikal */
    transform: translateY(-50%); /* Untuk menyeimbangkan posisi tengah vertikal */
}

.btn-info {
    background-color: #17a2b8; /* Biru muda */
    color: white;
    padding: 8px 16px;
    font-size: 14px;
    font-weight: 500;
    border-radius: 5px;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
}

/* Hover efek untuk tombol Lihat Data */
.btn-info:hover {
    background-color: #138496; /* Biru lebih gelap saat hover */
    box-shadow: 0 4px 8px rgba(23, 162, 184, 0.2); /* Shadow lembut */
}

.btn-info i {
    margin-right: 8px; /* Memberikan jarak antara ikon dan tulisan */
}


/* Menjaga form-group agar tetap responsif pada layar kecil */
@media (max-width: 768px) {
    .form-group.double-column {
        flex-direction: column;
    }

    .form-group.double-column .col-md-6 {
        width: 100%;
    }
}
</style>

<!-- page content -->
<div class="right_col" role="main">
    <div class="page-title">
        <div class="title_left">
            <h3>Manajemen Data Kepala Bidang</h3>
        </div>
        <div class="btn-wrapper-lihatdata">
            <button class="btn-minimal btn-info" onclick="window.location.href='/adminkabid/hasilinput'">
                <i class="fa fa-folder-open"></i> Lihat Data
            </button>
        </div>
    </div>

    <div class="clearfix"></div>
    <div class="col-md-12 col-sm-12">
        <div class="x_panel">
            <div class="x_title">
                <h2>Input Kabid <small>Masukkan data masing-masing dari kabid</small></h2>
                <ul class="nav navbar-right panel_toolbox">
                    <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a></li>
                </ul>
                <div class="clearfix"></div>
            </div>
            <div class="x_content">

                <!-- Smart Wizard -->
                <p style="color: red;">*Pastikan semua data yang Anda masukkan sudah benar dan lengkap sebelum menyimpannya</p>
                <div  class="form_wizard wizard_verticle">

                    <!-- Step 1 -->
                    <div id="step-1">
                        <form action="/admin/edit/<%= admin.id_adminkabid %>" method="POST" enctype="multipart/form-data" id="form-step-1" class="form-horizontal form-label-left" onsubmit="return false;">
                            <!-- Foto Profil -->
                            <div class="form-group row" style="text-align: center; margin-top: 20px;">
                                <div class="col-md-12">
                                    <label for="foto_profil_adminkabid" class="d-block">Foto Profil</label>
                                    <div id="drop-zone" style="width: 200px; height: 300px; border: 2px dashed #ccc; border-radius: 10px; display: flex; align-items: center; justify-content: center; margin: auto; cursor: pointer;">
                                        <i class="fa fa-upload" style="font-size: 30px; color: #ccc;"></i>
                                    </div>
                                    <input type="file" id="foto_profil_adminkabid" name="foto_profil_adminkabid" style="display: none;" accept="image/*" onchange="previewImage(event)">
                                    <div id="preview-container" style="margin-top: 10px;">
                                        <% if (admin.foto_profil_adminkabid) { %>
                                            <img src="/images/<%= admin.foto_profil_adminkabid %>" id="preview-image" src="" alt="Preview Foto" style="max-width: 200px; display: none;">
                                        <% } %>
                                    </div>
                                </div>
                            </div>

                            <!-- Kotakan untuk data -->
                            <div class="data-box">
                                <div class="form-wrapper">
                                    <!-- Kolom 1 -->
                                    <div class="form-group">
                                        <label class="col-form-label">Nama Lengkap*</label>
                                        <input type="text" id="nama_adminkabid" name="nama_adminkabid" value="<%= admin.nama_adminkabid %>" required class="form-control" autocomplete="off">
                                    </div>
                            
                                    <div class="form-group">
                                        <label class="col-form-label">Nomor NIP*</label>
                                        <input type="text" id="nip_adminkabid" name="nip_adminkabid" value="<%= admin.nip_adminkabid %>" required class="form-control" autocomplete="off">
                                    </div>
                            
                                    <div class="form-group">
                                        <label class="col-form-label">Nama Bidang*</label>
                                        <select name="bidang_id" class="form-control" required>
                                            <option value="">Pilih Bidang</option>
                                            <% bidang.forEach(function(bidang) { %>
                                                <option value="<%= bidang.id_bidang %>" <%= admin.bidang_id === bidang.id_bidang ? 'selected' : '' %> >
                                                    <%= bidang.nama_bidang %>
                                                  </option>
                                            <% }); %>
                                        </select>
                                    </div>
                            
                                    <!-- Kolom 2 -->
                                    <div class="form-group">
                                        <label class="col-form-label">Jabatan*</label>
                                        <input type="text" id="jabatan_adminkabid" name="jabatan_adminkabid" value="<%= admin.jabatan_adminkabid %>" required class="form-control" autocomplete="off">
                                    </div>
                            
                                    <div class="form-group">
                                        <label class="col-form-label">Alamat*</label>
                                        <input type="text" id="alamat_adminkabid" name="alamat_adminkabid" value="<%= admin.alamat_adminkabid %>" required class="form-control" autocomplete="off">
                                    </div>
                            
                                    <div class="form-group">
                                        <label class="col-form-label">Nomor Telepon*</label>
                                        <input type="text" id="no_telp_adminkabid" name="no_telp_adminkabid" value="<%= admin.no_telp_adminkabid %>" required class="form-control" autocomplete="off">
                                    </div>
                            
                                    <div class="form-group">
                                        <label class="col-form-label">Email*</label>
                                        <input type="email" id="email_adminkabid" name="email_adminkabid" value="<%= admin.email_adminkabid %>" required class="form-control" autocomplete="off">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Kotakan terpisah untuk Username dan Password -->
                            <div class="data-box" style="margin-top: 20px;">
                                <h4 style="margin-bottom: 15px; font-weight: bold;">Akun Login</h4>
                                <div class="form-wrapper">
                                    <!-- Username -->
                                    <div class="form-group">
                                        <label class="col-form-label">Username*</label>
                                        <input type="text" id="username_adminkabid" name="username_adminkabid" value="<%= admin.username_adminkabid %>" required class="form-control" autocomplete="off">
                                    </div>
                            
                                    <!-- Password -->
                                    <div class="form-group">
                                        <label class="col-form-label">Password</label>
                                        <div style="position: relative;">
                                            <input type="password" id="password_adminkabid" name="password_adminkabid" placeholder="Kosongkan jika tidak diubah" required class="form-control">
                                            <i class="fa fa-eye" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer;" onclick="togglePassword('password_adminkabid')"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Tombol -->
                            <div class="btn-wrapper" style="text-align: center; margin-top: 20px;">
                                <button class="btn-minimal btn-danger" type="reset">Reset</button>
                                <button type="submit" class="btn-minimal btn-success" onclick="submitForm()">Update</button>
                            </div>
                            

                        </form>
                    </div>

                </div>

            </div>
        </div>
    </div>
</div>

<script>
function previewImage(event) {
    const input = event.target;
    const dropZone = document.getElementById('drop-zone');
    const previewImage = document.getElementById('preview-image');

    // Pastikan ada file yang diunggah
    if (input.files && input.files[0]) {
        const reader = new FileReader();

        reader.onload = function (e) {
            // Set gambar ke dalam kotak drop zone
            previewImage.src = e.target.result;
            previewImage.style.display = 'block'; // Tampilkan gambar
            dropZone.innerHTML = '';  // Hapus konten sebelumnya (ikon upload)
            dropZone.appendChild(previewImage);  // Masukkan gambar ke dalam kotak
            
        };
        reader.readAsDataURL(input.files[0]);
    }
}

// Event listener untuk klik pada drop-zone
document.getElementById('drop-zone').addEventListener('click', () => {
    document.getElementById('foto_profil_adminkabid').click(); // Trigger klik pada input file saat drop zone diklik
});

window.onload = function() {
              // Set input password menjadi 'password' (tersembunyi) saat halaman pertama kali dimuat
              const passwordField = document.getElementById('password_adminkabid');
              const toggleButton = passwordField.nextElementSibling;
          
              // Set default mata tertutup
              passwordField.setAttribute("type", "password"); // Password tersembunyi saat halaman dimuat
              toggleButton.classList.add("fa-eye-slash");  // Ikon mata tertutup saat halaman dimuat
            };
          
            function togglePassword(inputId) {
              const passwordField = document.getElementById(inputId);
              const toggleButton = passwordField.nextElementSibling;
          
              // Toggle tipe input antara 'password' (tersembunyi) dan 'text' (terlihat)
              const type = passwordField.getAttribute("type") === "password" ? "text" : "password";
              passwordField.setAttribute("type", type);
          
              // Toggle ikon mata
              if (passwordField.getAttribute("type") === "text") {
                toggleButton.classList.remove("fa-eye-slash");
                toggleButton.classList.add("fa-eye");
              } else {
                toggleButton.classList.remove("fa-eye");
                toggleButton.classList.add("fa-eye-slash");
              }
            }

            function showSuccessNotification() {
  Swal.fire({
    icon: 'success',
    title: 'Data Berhasil Disimpan!',
    text: 'Data Kepala Bidang berhasil disimpan.',
    showConfirmButton: false,
    timer: 3000,
    willClose: () => {
      console.log("Redirecting to:", '/adminkabid/hasilinput'); // Log URL
      Swal.fire({
        icon: 'info',
        title: 'Lihat Data',
        text: 'Klik tombol di bawah untuk melihat data yang sudah disimpan.',
        showCancelButton: true,
        confirmButtonText: 'Lihat Data',
        cancelButtonText: 'Tutup',
      }).then((result) => {
        if (result.isConfirmed) {
            window.location.assign('/adminkabid/hasilinput');
        }
      });
    }
  });
}

// Event listener untuk form submit
document.getElementById('form-step-1').addEventListener('submit', async function (e) {
  e.preventDefault();  // Mencegah form submit otomatis

  const formData = new FormData(this);  // Ambil data dari form
  const response = await fetch('/adminkabid/edit', {
    method: 'POST',
    body: formData
  });

  const result = await response.json();

  if (result.success) {
    showSuccessNotification();  // Tampilkan notifikasi sukses
  } else {
    Swal.fire({
      icon: 'error',
      title: 'Gagal Menyimpan Data',
      text: result.message,
      confirmButtonText: 'Coba Lagi'
    });
  }
});

</script>

<!-- Tambahkan SweetAlert2 CDN -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<%- include('../partials/footer__') %>
